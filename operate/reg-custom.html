<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/xdoc/operate/reg-custom.xml.vm at 2021-12-10
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>Registry Application &#x2013; Registry Customization</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://pds.nasa.gov" id="bannerLeft"><img src="../images/pds_banner.png"  alt="" width="500"/></a></div>
          <div class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" id="bannerRight"><h2>PDS Registry</h2>
</a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-12-10<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.2</li>
      <li class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" class="externalLink" title="Registry App Github Repo">Registry App Github Repo</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Software Documentation</li>
    <li><a href="../index.html" title="About PDS Registry Application"><span class="none"></span>About PDS Registry Application</a></li>
    <li><a href="../install/index.html" title="Installation"><span class="icon-chevron-down"></span>Installation</a>
     <ul class="nav nav-list">
      <li><a href="../install/java.html" title="Java"><span class="none"></span>Java</a></li>
      <li><a href="../install/es-dev.html" title="Elasticsearch - Quick Start"><span class="none"></span>Elasticsearch - Quick Start</a></li>
      <li><a href="../install/tools.html" title="Tools (Manager, Harvest)"><span class="none"></span>Tools (Manager, Harvest)</a></li>
      <li><a href="../install/api-server.html" title="API Server"><span class="none"></span>API Server</a></li>
      <li><a href="../install/test.html" title="Test your deployment"><span class="none"></span>Test your deployment</a></li>
     </ul></li>
    <li><a href="../operate/index.html" title="Operation"><span class="icon-chevron-down"></span>Operation</a>
     <ul class="nav nav-list">
      <li><a href="../operate/common-ops.html" title="Common Operations"><span class="none"></span>Common Operations</a></li>
      <li><a href="../operate/test-vs-prod.html" title="Test vs Prod"><span class="none"></span>Test vs Prod</a></li>
      <li><a href="../operate/harvest.html" title="Harvest"><span class="none"></span>Harvest</a></li>
      <li><a href="../operate/reg-manager.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
      <li><a href="../operate/supplementer.html" title="Supplementer"><span class="none"></span>Supplementer</a></li>
      <li class="active"><a href="#"><span class="none"></span>Registry Customization</a></li>
     </ul></li>
    <li><a href="../prod/index.html" title="Production Deployment"><span class="icon-chevron-down"></span>Production Deployment</a>
     <ul class="nav nav-list">
      <li><a href="../prod/es-vm.html" title="Elasticsearch (VM)"><span class="none"></span>Elasticsearch (VM)</a></li>
     </ul></li>
    <li><a href="../security/index.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../security/proxy.html" title="Load Balancer & Proxy"><span class="none"></span>Load Balancer & Proxy</a></li>
      <li><a href="../security/es.html" title="Elasticsearch"><span class="none"></span>Elasticsearch</a></li>
      <li><a href="../security/reg-mgr.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
     </ul></li>
    <li><a href="../index.html#Support" title="Support"><span class="none"></span>Support</a></li>
   <li class="nav-header">Downloads</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/v1.0.2/pds-registry-app-1.0.2-bin.tar.gz" class="externalLink" title="Current Release (tar.gz)"><span class="none"></span>Current Release (tar.gz)</a></li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/v1.0.2/pds-registry-app-1.0.2-bin.zip" class="externalLink" title="Current Release (zip)"><span class="none"></span>Current Release (zip)</a></li>
    <li><a href="https://pds-engineering.jpl.nasa.gov/content/pds4-software" class="externalLink" title="Past Releases"><span class="none"></span>Past Releases</a></li>
   <li class="nav-header">Change Log</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/blob/main/CHANGELOG.md" class="externalLink" title="On Github"><span class="none"></span>On Github</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >



<section>
<h2><a name="Registry_Customization"></a>Registry Customization</h2>



<p>
</p>
<ul>
  
<li><a href="#Overview">Overview</a></li>
  
<li><a href="#DD">Data Dictionary</a></li>
  
<li><a href="#SchemaUpdate">Registry Schema Update</a></li>
</ul>




<a name="Overview"></a><section id="Overview">
<h3><a name="Overview"></a>Overview</h3>


<p>
Registry uses following Elasticsearch indices:
</p>


<ul>

<li><b>registry</b> - this index stores metadata extracted from PDS4 labels, one ES document per PDS label.</li>

<li><b>registry-dd</b> - this index stores data dictionary - a list of searchable fields and its data types.
When registry is created, the data dictionary is populated with fields (attributes) from PDS common and few discipline dictionaries.
You can add more fields as described in <a href="reg-custom.html#DD">Data Dictionary</a> section.</li>

<li><b>registry-refs</b> - this index stores product references extracted from collection inventory files.
There could be 1 or more ES documents per inventory file.</li>
</ul>


<p>
Default Elasticsearch schemas for these indices (<i>registry.json</i>, <i>data-dic.json</i>, and <i>refs.json</i>) 
are located in <i>REGISTRY_HOME/elastic/</i> directory.
Where <i>REGISTRY_HOME</i> is a directory where you installed Registry Manager, for example
<i>/home/pds/registry</i>.
</p>


<p>
Default registry schema defines few common fields such as lid, vid, title, internal refrences and basic file information.
Also, there is a binary field to store the whole PDS label as a BLOB. Lidvid is a primary key.
</p>


<p>
Dynamic field mapping is disabled to prevent creation of fields not in the data dictionary.
</p>

<div class="source"><pre class="prettyprint">
...
&quot;mappings&quot;: {
    &quot;dynamic&quot;: false, 
...
}
</pre></div>


<p>
After running Harvest, the output folder (default is /tmp/harvest/out/) will have several files
</p>
<ul>

<li><i>registry-docs.json</i> - metadata extracted from PDS4 labels, stored in Newline-delimited JSON (NJSON) format.</li>

<li><i>refs-docs.json</i> - product references extracted from collection inventory files.</li>

<li><i>fields.txt</i> - a list of field names extracted from PDS4 labels.</li>
</ul>



<p>
When you load data
</p>


<div class="source"><pre class="prettyprint">
registry-manager load-data -dir /home/pds/harvest/out/
</pre></div>


<p>
Registry Manager will try to update registry schema (add more fields) from <i>fields.txt</i> file.
Those fields must exist in the data dictionary index. Otherwise you will get the following error:
</p>

<div class="source"><pre class="prettyprint">
[ERROR] Could not find datatype for field '...'
</pre></div>


<p>
You can disable schema update by passing extra parameter, but it is not recommended.
</p>


<div class="source"><pre class="prettyprint">
registry-manager load-data -dir /home/pds/harvest/out -updateSchema n
</pre></div>


<p>
If you disable schema update, fields not in Elasticsearch schema are not indexed, 
but they are still available in &quot;_source&quot; field.
</p>


<p>
Next section describes how to manage registry data dictionary.
</p>
</section>



<a name="DD"></a><section id="DD">
<h3><a name="Data_Dictionary"></a>Data Dictionary</h3>


<p>
When a registry is created, the data dictionary is populated with fields (attributes) from 
PDS common and few discipline dictionaries.
Latest versions of PDS4 data dictionaries in different formates are available at 
<a class="externalLink" href="https://pds.nasa.gov/datastandards/dictionaries/" target="_blank">PDS website</a>.
</p>


<p>
The following naming convention is used for Elasticsearch fields:
</p>

<div class="source"><pre class="prettyprint">
namespace:Class_Name/namespace:attribute_name
</pre></div>


<p>
For example,
</p>

<div class="source"><pre class="prettyprint">
disp:Display_Direction/disp:vertical_display_direction
geom:Articulation_Device_Parameters/geom:device_id
pds:XML_Schema/pds:name
proc:Software_Program/proc:name
</pre></div>

<section>
<h4><a name="Loading_Data_Dictionaries"></a>Loading Data Dictionaries</h4>

<p>
You can load data dictionaries in following formats: 
</p>
<ul>

<li>Standard PDS4 data dictionary JSON file, for example, <i>orex_ldd_OREX_1300.JSON</i></li>

<li>Custom CSV file</li>

<li>Data dump created by 'export-dd' command (NJSON)</li>
</ul>



<p>
For example, to load standard PDS4 data dictionary, run the following command:
</p>

<div class="source"><pre class="prettyprint">
registry-manager load-dd -dd /home/pds/schema/orex_ldd_OREX_1300.JSON
</pre></div>


<p>
Elasticsearch data dictionary schema has following fields.
</p>
<ul>

<li><i>class_ns</i> - class namespace, e.g., &quot;pds&quot;</li>

<li><i>class_name</i> - class name, e.g., &quot;Element_Array&quot;</li>

<li><i>attr_ns</i> - attribute namespace, e.g., &quot;pds&quot;</li>

<li><i>attr_name</i> - attribute name, e.g., &quot;scaling_factor&quot;</li>

<li><i>data_type</i> - PDS data type, e.g., &quot;ASCII_Real&quot;</li>

<li><i>description</i> - field description</li>

<li><i>es_field_name</i> - Elasticsearch field name, e.g., &quot;pds/Element_Array/pds/scaling_factor&quot;</li>

<li><i>es_data_type</i> - Elasticsearch data type, e.g., &quot;double&quot;</li>
</ul>



<p>
If you load standard PDS JSON data dictionary, all these fields are populated automatically.
If you use custom CSV file, &quot;es_field_name&quot; and &quot;es_data_type&quot; are required and other fields are optional.
The CSV file must have a header with data dictionary field names, for example,
</p>


<div class="source"><pre class="prettyprint">
es_field_name,es_data_type
my_namespace:My_Class/my_namespace:parameter_a,keyword
my_namespace:My_Class/my_namespace:parameter_b,integer
my_namespace:My_Class/my_namespace:parameter_c,double
</pre></div>


<p>
To load custom CSV file, run the following command:
</p>

<div class="source"><pre class="prettyprint">
registry-manager load-dd -csv /home/pds/schema/my-fields.csv
</pre></div>




</section><section>
<h4><a name="PDS_to_Elasticsearch_Data_Type_Mapping"></a>PDS to Elasticsearch Data Type Mapping</h4>


<p>
If you load standard PDS JSON data dictionary, PDS data types, such as <i>pds.ASCII_Real</i>
are automatically mapped to Elasticsearch data types, such as <i>double</i>.
The mappings are stored in <i>REGISTRY_HOME/elastic/data-dic-types.cfg</i> file.
You can modify this file, to add more mappings or change default values.
</p>


<p>
The file has the following format:
</p>

<div class="source"><pre class="prettyprint">
&lt;PDS data type&gt; = &lt;Elasticsearch data type&gt;
</pre></div>


<p>
For example,
</p>


<div class="source"><pre class="prettyprint">
pds.ASCII_Integer = integer
pds.ASCII_Boolean = boolean
pds.ASCII_Real = double
pds.ASCII_Short_String_Collapsed = keyword
...
</pre></div>

</section></section>



<a name="SchemaUpdate"></a><section id="SchemaUpdate">
<h3><a name="Registry_Schema_Update"></a>Registry Schema Update</h3>


<p>
As described in Overview section, registry schema is updated automatically when you load data.
</p>


<p>
You can also update registry schema by calling <i>update-schema</i> command:
</p>


<div class="source"><pre class="prettyprint">
registry-manager update-schema -file /home/pds/harvest/out/fields.txt
</pre></div>

<p>
You can either use <i>fields.txt</i> generated by Harvest or use your own file.
The file contains a list of field names you want to add, one entry per line, for example
</p>


<div class="source"><pre class="prettyprint">
ops:Harvest_Info/ops:node_name
ops:Label_File_Info/ops:creation_date_time
ops:Label_File_Info/ops:file_name
</pre></div>


<p>
Those fields must exist in the data dictionary index. Otherwise you will get the following error:
</p>

<div class="source"><pre class="prettyprint">
[ERROR] Could not find datatype for field '...'
</pre></div>


<p>
Existing fields in registry collection are ignored.
</p>

</section>

</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2021<a href="https://pds.nasa.gov/">Planetary Data System</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
