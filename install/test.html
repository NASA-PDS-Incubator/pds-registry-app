<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/xdoc/install/test.xml.vm at 2021-12-10
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>Registry Application &#x2013; Test Your Deployment</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://pds.nasa.gov" id="bannerLeft"><img src="../images/pds_banner.png"  alt="" width="500"/></a></div>
          <div class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" id="bannerRight"><h2>PDS Registry</h2>
</a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-12-10<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.1</li>
      <li class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" class="externalLink" title="Registry App Github Repo">Registry App Github Repo</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Software Documentation</li>
    <li><a href="../index.html" title="About PDS Registry Application"><span class="none"></span>About PDS Registry Application</a></li>
    <li><a href="../install/index.html" title="Installation"><span class="icon-chevron-down"></span>Installation</a>
     <ul class="nav nav-list">
      <li><a href="../install/java.html" title="Java"><span class="none"></span>Java</a></li>
      <li><a href="../install/es-dev.html" title="Elasticsearch - Quick Start"><span class="none"></span>Elasticsearch - Quick Start</a></li>
      <li><a href="../install/tools.html" title="Tools (Manager, Harvest)"><span class="none"></span>Tools (Manager, Harvest)</a></li>
      <li><a href="../install/api-server.html" title="API Server"><span class="none"></span>API Server</a></li>
      <li class="active"><a href="#"><span class="none"></span>Test your deployment</a></li>
     </ul></li>
    <li><a href="../operate/index.html" title="Operation"><span class="icon-chevron-down"></span>Operation</a>
     <ul class="nav nav-list">
      <li><a href="../operate/common-ops.html" title="Common Operations"><span class="none"></span>Common Operations</a></li>
      <li><a href="../operate/test-vs-prod.html" title="Test vs Prod"><span class="none"></span>Test vs Prod</a></li>
      <li><a href="../operate/harvest.html" title="Harvest"><span class="none"></span>Harvest</a></li>
      <li><a href="../operate/reg-manager.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
      <li><a href="../operate/supplementer.html" title="Supplementer"><span class="none"></span>Supplementer</a></li>
      <li><a href="../operate/reg-custom.html" title="Registry Customization"><span class="none"></span>Registry Customization</a></li>
     </ul></li>
    <li><a href="../prod/index.html" title="Production Deployment"><span class="icon-chevron-down"></span>Production Deployment</a>
     <ul class="nav nav-list">
      <li><a href="../prod/es-vm.html" title="Elasticsearch (VM)"><span class="none"></span>Elasticsearch (VM)</a></li>
     </ul></li>
    <li><a href="../security/index.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../security/proxy.html" title="Load Balancer & Proxy"><span class="none"></span>Load Balancer & Proxy</a></li>
      <li><a href="../security/es.html" title="Elasticsearch"><span class="none"></span>Elasticsearch</a></li>
      <li><a href="../security/reg-mgr.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
     </ul></li>
    <li><a href="../index.html#Support" title="Support"><span class="none"></span>Support</a></li>
   <li class="nav-header">Downloads</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/v1.0.1/pds-registry-app-1.0.1-bin.tar.gz" class="externalLink" title="Current Release (tar.gz)"><span class="none"></span>Current Release (tar.gz)</a></li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/v1.0.1/pds-registry-app-1.0.1-bin.zip" class="externalLink" title="Current Release (zip)"><span class="none"></span>Current Release (zip)</a></li>
    <li><a href="https://pds-engineering.jpl.nasa.gov/content/pds4-software" class="externalLink" title="Past Releases"><span class="none"></span>Past Releases</a></li>
   <li class="nav-header">Change Log</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/blob/main/CHANGELOG.md" class="externalLink" title="On Github"><span class="none"></span>On Github</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >

  

<section>
<h2><a name="Test_Your_Deployment"></a>Test Your Deployment</h2>


<ul>

<li><a href="#overview">Overview</a></li>

<li><a href="#harvest">Extract metadata from PDS4 labels</a></li>

<li><a href="#create">Create Registry</a></li>

<li><a href="#load">Load harvested data into Registry (Elasticsearch)</a></li>

<li><a href="#query">Query Elasticsearch</a></li>

<li><a href="#api">Use Registry API</a></li>
</ul>

<a name="overview"></a><section id="overview">
<h3><a name="Overview"></a>Overview</h3>
This document describes common tasks to do with the Registry, such as initializing your Registry, 
extracting metadata from PDS4 labels and loading it into the Registry, querying Elasticsearch,
and using Registry APIs.
</section>

<a name="harvest"></a><section id="harvest">
<h3><a name="Extract_metadata_from_PDS4_labels"></a>Extract metadata from PDS4 labels</h3>

<p>
To extract metadata from PDS4 labels (XML files) you have to use Harvest command-line tool.
Harvest parses PDS4 files and stores extracted metadata in a &quot;newline delimited JSON&quot; data file.
The JSON data file can be loaded into Elasticsearch by Registry Manager.
</p>


<p>
To run Harvest you need an XML configuration file. 
The configuration file has several sections which control which files the Harvest tool 
will crawl and what data to extract. Very basic configuration is shown below.
</p>
<div class="source"><pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;harvest nodeName=&quot;PDS_ENG&quot;&gt;
  &lt;directories&gt;
    &lt;path&gt;/data/LADEE/ldex_20161118&quot;&lt;/path&gt;
  &lt;/directories&gt;
&lt;/harvest&gt;
</pre></div>



<p>
You can process bundles or directories. There are few example configuration files in Harvest installation
directory, e.g., <i>harvest-3.5.1/conf/examples/directories.xml</i>.
Either edit one of the example files or use the minimal configuration shown above.
Note that you have to use a valid value of &quot;nodeName&quot; attribute.
</p>


<p>
Update the path with the location of your dataset. 

A sample PDS4 archive is provided in the `test` folder of the <i>pds-registry-app</i> package which you just installed.

IMPORTANT NOTE: don't keep this sample dataset in a production registry. 

More information about Harvest configuration is available in <a href="../operate/harvest.html">Harvest operation documentation</a>.
</p>
	    

<p>
To run Harvest, use <i>harvest</i> command on Unix or <i>harvest.bat</i> on Windows.
The following Unix example uses <i>config.xml</i> configuration file. 
The generated JSON data files will be saved in <i>~/tmp/data1</i> directory.
</p>


<div class="source"><pre class="prettyprint">
harvest -c /path/to/my/config.xml -o ~/tmp/data1
</pre></div>


<p>
After running Harvest, the output folder (<i>~/tmp/data1</i>) will have several files:
</p>
<ul>

<li><i>registry-docs.json</i> - metadata extracted from PDS4 labels, stored in Newline-delimited JSON (NJSON) format.</li>

<li><i>refs-docs.json</i> - product references extracted from collection inventory files.</li>

<li><i>fields.txt</i> - a list of field names extracted from PDS4 labels.</li>
</ul>


</section>


	
<a name="create"></a><section id="create">
<h3><a name="Create_Registry"></a>Create Registry</h3>


<p>
You must create following registry indices in Elasticsearch, before loading data generated by Harvest tool.
</p>

<ul>

<li><b>registry</b> - this index stores metadata extracted from PDS4 labels, one ES document per PDS label.</li>

<li><b>registry-dd</b> - this index stores data dictionary - a list of searchable fields and its data types.
When registry is created, the data dictionary is populated with fields (attributes) from PDS common and few discipline dictionaries.
You can add more fields as described in <a href="reg-custom.html#DD">Registry Customization / Data Dictionary</a> section.</li>

<li><b>registry-refs</b> - this index stores product references extracted from collection inventory files.
There could be 1 or more ES documents per inventory file.</li>
</ul>


<p>
To create registry indices in local Elasticsearch (running at <i>http://localhost:9200</i>) 
with 1 shard and 0 replicas, run the following Registry Manager command
</p>

<div class="source"><pre class="prettyprint">
registry-manager create-registry
</pre></div>


<p>
You can customize <i>create-registry</i> command by passing several parameters, 
such as Elasticsearch URL, number of shards and replicas, authentication parameters.
To see the list of available parameters and basic usage run
</p>
<div class="source"><pre class="prettyprint">
registry-manager create-registry -help
</pre></div>



<p>
To check that registry indices were created open the following URL in 
a browser: <i>http://localhost:9200/_cat/indices?v</i> or use <i>curl</i>.
</p>

<div class="source"><pre class="prettyprint">
curl &quot;http://localhost:9200/_cat/indices?v&quot;
</pre></div>


<p>
The response should look similar to this. Make sure that index status is &quot;green&quot;. 
</p>

<div class="source"><pre class="prettyprint">
health status index         uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   registry      PY6ObzELRlSx9gHOWbR8dw   1   0          0            0       208b           208b
green  open   registry-dd   CuJ-nqg1SbKI9hejHrISWA   1   0       2505            0      625kb          625kb
green  open   registry-refs 1cJLc-9cQj2D_MAYo7gOpw   1   0          0            0       208b           208b
</pre></div>

<section>
<h4><a name="Registry_Data_Dictionary"></a>Registry Data Dictionary</h4>


<p>
When a registry is created, the registry data dictionary is populated with fields (attributes) from 
PDS common and few discipline dictionaries. There are many data dictionaries at 
<a class="externalLink" href="https://pds.nasa.gov/datastandards/dictionaries/" target="_blank">PDS website</a> but only
few of them are loaded into Registry by default.
</p>

<p>
You may need to load more data dictionaries as described in <a href="../operate/reg-custom.html">Registry Customization</a> section.
</p>

</section></section>


	
<a name="load"></a><section id="load">
<h3><a name="Load_harvested_data_into_Registry_.28Elasticsearch.29"></a>Load harvested data into Registry (Elasticsearch)</h3>


<p>
JSON files generated by Harvest, can be loaded into Elasticsearch by Registry Manager as shown below. 
</p>


<div class="source"><pre class="prettyprint">
registry-manager load-data -dir ~/tmp/data1/
</pre></div>


<p>
Where <i>~/tmp/data1/</i> is the Harvest output directory with JSON files.
</p>


<p>
By default, Registry Manager will try updating Registry schema (add more fields)
from <i>fields.txt</i> file generated by Harvest in <i>~/tmp/data1/</i>.
</p>


<p>
If you try loading JSON data files with fields not defined in the Registry data dictionary,
you will get the following error:
</p>

<div class="source"><pre class="prettyprint">
[ERROR] Could not find datatype for field '...'
</pre></div>


<p>
You have to update the registry data dictionary as described in <a href="reg-custom.html">Registry Customization</a> section
before you can load the data.
</p>

</section>


	
<a name="query"></a><section id="query">
<h3><a name="Query_Elasticsearch"></a>Query Elasticsearch</h3>


<p>
You can query Registry indices in Elasticsearch by calling
<a class="externalLink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.8/search-search.html" target="_blank">Elasticsearch Search API</a>.
</p>




<p>
You can either use simple Lucene queries, passed in the URL:
</p>

<div class="source"><pre class="prettyprint">
# Select all products
curl &quot;http://localhost:9200/registry/_search?q=*&amp;pretty&quot;

# Select only collections
curl &quot;http://localhost:9200/registry/_search?q=product_class:Product_Collection&amp;pretty&quot;
</pre></div>


<p>
Or more advanced Elasticsearch queries defined in JSON and passed in the request body:
</p>


<div class="source"><pre class="prettyprint">
curl -X GET &quot;localhost:9200/registry/_search?pretty&quot; -H 'Content-Type: application/json' -d'
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;product_class&quot;: &quot;Product_Collection&quot;
    }
  }
}
'
</pre></div>

</section>



<a name="api"></a><section id="api">
<h3><a name="Use_Registry_API"></a>Use Registry API</h3>
<section>
<h4><a name="Swagger_UI"></a>Swagger UI</h4>


<p>
Open <i>http://localhost:8080</i> URL in a web browser.
You should see a page similar to this.
</p>

<img src="../images/swagger-ui.png" style="width:50em;" alt="" />


<p>
Select an API you want to call, for example <i>collections</i>
</p>

<img src="../images/swagger2.png" style="width:60em;" alt="" />


<p>
Select response content type &quot;application/json&quot; from a dropdown and click &quot;Try it out!&quot; button.
You should see JSON response in &quot;Response Body&quot; section of the screen. 
You might need to scroll down to see the results.
</p>

</section><section>
<h4><a name="Curl"></a>Curl</h4>


<p>
You can also use <i>curl</i> to call Registry API. For example,
</p>


<div class="source"><pre class="prettyprint">
curl -X GET --header 'Accept: application/json' 'http://localhost:8000/collections?limit=10'
</pre></div>

</section></section>
	
        
</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2021<a href="https://pds.nasa.gov/">Planetary Data System</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
