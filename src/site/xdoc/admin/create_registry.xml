<?xml version="1.0" encoding="UTF-8"?>

<!--
  Copyright 2019, California Institute of Technology ("Caltech").
  U.S. Government sponsorship acknowledged.
  
  All rights reserved.
  
  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
  * Redistributions must reproduce the above copyright notice, this list of
  conditions and the following disclaimer in the documentation and/or other
  materials provided with the distribution.
  * Neither the name of Caltech nor its operating division, the Jet Propulsion
  Laboratory, nor the names of its contributors may be used to endorse or
  promote products derived from this software without specific prior written
  permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  POSSIBILITY OF SUCH DAMAGE.
-->

<document>
<properties>
  <title>Create / Delete Registry</title>
</properties>

<body>

<section name="Create / Delete Registry">

<p>
<ul>
  <li><a href="#Overview">Overview</a></li>
  <li><a href="#Prereq">Prerequisites</a></li>
  <li><a href="#Create">Create Registry</a></li>
  <li><a href="#Delete">Delete Registry</a></li>
</ul>
</p>

<!-- ======================================================== -->

<subsection name="Overview" id="Overview">
<p>
You must create following registry indices in Elasticsearch, before running any Harvest server or 
client components, such as Crawler Server, Harvest Server, Standalone Harvest CLI or Harvest Client CLI.
</p>

<ul>
<li><b>registry</b> - this index stores metadata extracted from PDS4 labels, one ES document per PDS label.</li>
<li><b>registry-dd</b> - this index stores data dictionary - a list of searchable fields and its data types.
When registry is created, the data dictionary is populated with fields (attributes) from PDS common and few discipline dictionaries.
Harvest automatically loads new dictionaries from schema location specified in PDS4 labels.
You can also add more fields and LDDs manually as described in <a href="reg-custom.html#DD">Registry Customization / Data Dictionary</a> section.</li>
<li><b>registry-refs</b> - this index stores product references extracted from collection inventory files.
There could be 1 or more ES documents per inventory file.</li>
</ul>

<p>
The indices are created with Registry Manager command-line tool.
</p>

</subsection>

<!-- ======================================================== -->

<subsection name="Prerequisites">

<ul>
  <li>Elasticsearch server is running.</li>
  <li>Registry Manager command-line tool is installed.</li>
</ul>

</subsection>

<!-- ======================================================== -->

<subsection name="Create Registry" id="Create">

<p>
To create registry indices in local Elasticsearch (running at <i>http://localhost:9200</i>) 
with 1 shard and 0 replicas, run the following Registry Manager command
</p>
<source>
registry-manager create-registry
</source>

<p>
You can customize <i>create-registry</i> command by passing several parameters, 
such as Elasticsearch URL, number of shards and replicas, authentication parameters.
To see the list of available parameters and basic usage run
<source>
registry-manager create-registry -help
</source>
</p>

<p>
To check that registry indices were created open the following URL in 
a browser: <i>http://localhost:9200/_cat/indices?v</i> or use <i>curl</i>.
</p>
<source>
curl "http://localhost:9200/_cat/indices?v"
</source>

<p>
The response should look similar to this. Make sure that index status is "green". 
</p>
<source>
health status index         uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   registry      PY6ObzELRlSx9gHOWbR8dw   1   0          0            0       208b           208b
green  open   registry-dd   CuJ-nqg1SbKI9hejHrISWA   1   0       2505            0      625kb          625kb
green  open   registry-refs 1cJLc-9cQj2D_MAYo7gOpw   1   0          0            0       208b           208b
</source>

</subsection>

<!-- ============================ -->

<subsection name="Delete Registry" id="Delete">

<p>
To delete registry indices from local Elasticsearch run the following command:
</p>
<source>
registry-manager delete-registry
</source>

<p>
You can customize <i>delete-registry</i> command by passing several parameters, 
such as Elasticsearch URL, and authentication parameters.
</p>

</subsection>
</section>

</body>
</document>
